# AuroraView åˆ†å±‚æ¶æ„è®¾è®¡

## ğŸ¯ è®¾è®¡ç›®æ ‡

1. **æ¸…æ™°çš„èŒè´£åˆ†ç¦»** - æ¯ä¸€å±‚åªè´Ÿè´£è‡ªå·±çš„äº‹æƒ…
2. **é¿å…é‡å¤ä¿®æ”¹** - åº•å±‚è§£å†³é—®é¢˜ï¼Œä¸Šå±‚è‡ªåŠ¨å—ç›Š
3. **æ˜“äºæ‰©å±•** - æ–°çš„é›†æˆï¼ˆå¦‚ Tkinterã€wxPythonï¼‰å®¹æ˜“æ·»åŠ 

## ğŸ“ å››å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application)                      â”‚
â”‚              maya_outliner.py, houdini_tool.py              â”‚
â”‚  èŒè´£ï¼šä¸šåŠ¡é€»è¾‘ã€DCC ç‰¹å®šåŠŸèƒ½                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ uses
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  é›†æˆå±‚ (Integration)                        â”‚
â”‚              QtWebView, TkWebView, WxWebView                â”‚
â”‚  èŒè´£ï¼šUI æ¡†æ¶é›†æˆã€æ¡†æ¶ç‰¹å®šçš„äº‹ä»¶å¾ªç¯å¤„ç†                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ inherits
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Python æŠ½è±¡å±‚ (Abstraction)                   â”‚
â”‚                       WebView                               â”‚
â”‚  èŒè´£ï¼šPython APIã€äº‹ä»¶å¤„ç†ç­–ç•¥ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ wraps
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Rust æ ¸å¿ƒå±‚ (Core)                          â”‚
â”‚                     AuroraView                              â”‚
â”‚  èŒè´£ï¼šWebView æ¸²æŸ“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å¹³å°çª—å£ç®¡ç†                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ å„å±‚èŒè´£

### 1. Rust æ ¸å¿ƒå±‚ (AuroraView)

**èŒè´£ï¼š**
- WebView æ¸²æŸ“å¼•æ“å°è£…
- æ¶ˆæ¯é˜Ÿåˆ—ç®¡ç†ï¼ˆJavaScript â†” Rustï¼‰
- å¹³å°çª—å£ç®¡ç†ï¼ˆWin32/X11/Cocoaï¼‰
- IPC é€šä¿¡

**ä¸è´Ÿè´£ï¼š**
- ä¸çŸ¥é“ Python çš„å­˜åœ¨
- ä¸çŸ¥é“ Qt/Tk ç­‰ UI æ¡†æ¶
- ä¸è‡ªåŠ¨å¤„ç†äº‹ä»¶ï¼ˆåªæä¾› `process_events()` æ–¹æ³•ï¼‰

**å…³é”®æ–¹æ³•ï¼š**
```rust
impl AuroraView {
    fn emit(&self, event_name: &str, data: &str);
    fn eval_js(&self, script: &str);
    fn process_events(&self) -> bool;  // å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—
}
```

### 2. Python æŠ½è±¡å±‚ (WebView)

**èŒè´£ï¼š**
- æä¾› Pythonic API
- å®šä¹‰äº‹ä»¶å¤„ç†ç­–ç•¥ï¼ˆé€šè¿‡ `_auto_process_events`ï¼‰
- ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼ˆshow/close/waitï¼‰
- æä¾›é»˜è®¤çš„äº‹ä»¶å¤„ç†å®ç°

**å…³é”®è®¾è®¡ï¼š**
```python
class WebView:
    def __init__(self):
        self._core = AuroraView(...)  # Rust æ ¸å¿ƒ
        self._event_processor = None  # äº‹ä»¶å¤„ç†å™¨ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰
    
    def set_event_processor(self, processor):
        """è®¾ç½®äº‹ä»¶å¤„ç†å™¨ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰"""
        self._event_processor = processor
    
    def _auto_process_events(self):
        """è‡ªåŠ¨å¤„ç†äº‹ä»¶ï¼ˆå¯è¢«é‡å†™æˆ–ä½¿ç”¨ç­–ç•¥ï¼‰"""
        if self._event_processor:
            self._event_processor.process()
        else:
            # é»˜è®¤å®ç°ï¼šç›´æ¥è°ƒç”¨ Rust
            self._core.process_events()
    
    def emit(self, event_name, data, auto_process=True):
        """å‘é€äº‹ä»¶"""
        self._core.emit(event_name, data)
        if auto_process:
            self._auto_process_events()
    
    def eval_js(self, script, auto_process=True):
        """æ‰§è¡Œ JavaScript"""
        self._core.eval_js(script)
        if auto_process:
            self._auto_process_events()
```

### 3. é›†æˆå±‚ (QtWebView, TkWebView, etc.)

**èŒè´£ï¼š**
- UI æ¡†æ¶ç‰¹å®šçš„é›†æˆ
- å¤„ç†æ¡†æ¶çš„äº‹ä»¶å¾ªç¯
- æä¾›æ¡†æ¶ç‰¹å®šçš„ API

**QtWebView å®ç°ï¼š**
```python
class QtEventProcessor:
    """Qt äº‹ä»¶å¤„ç†å™¨ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰"""
    def __init__(self, webview):
        self._webview = webview
    
    def process(self):
        """å¤„ç† Qt äº‹ä»¶ + WebView äº‹ä»¶"""
        from qtpy.QtCore import QCoreApplication
        QCoreApplication.processEvents()  # Qt äº‹ä»¶
        self._webview._core.process_events()  # WebView äº‹ä»¶

class QtWebView(QWidget):
    def __init__(self, parent=None, **kwargs):
        super().__init__(parent)
        
        # åˆ›å»º WebView
        self._webview = WebView(**kwargs)
        
        # è®¾ç½® Qt äº‹ä»¶å¤„ç†å™¨
        processor = QtEventProcessor(self._webview)
        self._webview.set_event_processor(processor)
    
    def emit(self, event_name, data, auto_process=True):
        """å§”æ‰˜ç»™ WebView"""
        self._webview.emit(event_name, data, auto_process)
```

### 4. åº”ç”¨å±‚ (maya_outliner.py)

**èŒè´£ï¼š**
- ä¸šåŠ¡é€»è¾‘
- DCC ç‰¹å®šåŠŸèƒ½
- ç”¨æˆ·äº¤äº’

**ä½¿ç”¨æ–¹å¼ï¼š**
```python
# åº”ç”¨å±‚åªéœ€è¦ä½¿ç”¨ï¼Œä¸éœ€è¦å…³å¿ƒåº•å±‚å®ç°
webview = QtWebView(parent=maya_window)
webview.emit("scene_updated", {"nodes": [...]})
# âœ… äº‹ä»¶è‡ªåŠ¨å¤„ç†ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ process_events()
```

## ğŸ ä¼˜åŠ¿

### 1. èŒè´£æ¸…æ™°

| å±‚æ¬¡ | èŒè´£ | ä¸è´Ÿè´£ |
|------|------|--------|
| Rust | æ¸²æŸ“ã€æ¶ˆæ¯é˜Ÿåˆ— | UI æ¡†æ¶ã€äº‹ä»¶å¾ªç¯ |
| Python WebView | APIã€ç­–ç•¥ | UI æ¡†æ¶ç‰¹å®šé€»è¾‘ |
| Qt/Tk é›†æˆ | æ¡†æ¶é›†æˆ | ä¸šåŠ¡é€»è¾‘ |
| åº”ç”¨ | ä¸šåŠ¡é€»è¾‘ | åº•å±‚å®ç° |

### 2. é¿å…é‡å¤ä¿®æ”¹

```python
# âœ… åº•å±‚ä¿®æ”¹ä¸€æ¬¡ï¼Œæ‰€æœ‰é›†æˆè‡ªåŠ¨å—ç›Š
class WebView:
    def emit(self, event_name, data, auto_process=True):
        self._core.emit(event_name, data)
        if auto_process:
            self._auto_process_events()  # æ‰€æœ‰å­ç±»è‡ªåŠ¨è°ƒç”¨

# QtWebViewã€TkWebViewã€WxWebView éƒ½è‡ªåŠ¨è·å¾—è¿™ä¸ªè¡Œä¸º
```

### 3. æ˜“äºæ‰©å±•

```python
# æ·»åŠ æ–°çš„ UI æ¡†æ¶é›†æˆéå¸¸ç®€å•
class TkEventProcessor:
    def process(self):
        self._root.update()  # Tk äº‹ä»¶
        self._webview._core.process_events()  # WebView äº‹ä»¶

class TkWebView(tk.Frame):
    def __init__(self, parent, **kwargs):
        super().__init__(parent)
        self._webview = WebView(**kwargs)
        processor = TkEventProcessor(self._webview, parent)
        self._webview.set_event_processor(processor)
```

## ğŸ”„ äº‹ä»¶å¤„ç†æµç¨‹

```
åº”ç”¨å±‚è°ƒç”¨
    â†“
webview.emit("event", data)
    â†“
WebView.emit()
    â†“
self._core.emit()  â† Rust å±‚ï¼šæ¨é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—
    â†“
self._auto_process_events()
    â†“
self._event_processor.process()  â† ç­–ç•¥æ¨¡å¼
    â†“
QtEventProcessor.process()
    â”œâ”€ QCoreApplication.processEvents()  â† Qt äº‹ä»¶
    â””â”€ self._webview._core.process_events()  â† WebView æ¶ˆæ¯é˜Ÿåˆ—
        â†“
        Rust å±‚ï¼šå¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ‰§è¡Œ JavaScript
```

## ğŸ“ å®ç°è®¡åˆ’

### Phase 1: é‡æ„ WebView åŸºç±»
- [ ] æ·»åŠ  `set_event_processor()` æ–¹æ³•
- [ ] é‡æ„ `_auto_process_events()` ä½¿ç”¨ç­–ç•¥æ¨¡å¼
- [ ] ä¿æŒå‘åå…¼å®¹ï¼ˆæ”¯æŒç›´æ¥é‡å†™ `_auto_process_events()`ï¼‰

### Phase 2: é‡æ„ QtWebView
- [ ] åˆ›å»º `QtEventProcessor` ç±»
- [ ] åœ¨ `__init__` ä¸­è®¾ç½®å¤„ç†å™¨
- [ ] ç®€åŒ– `_process_pending_events()`

### Phase 3: æ–‡æ¡£å’Œæµ‹è¯•
- [ ] æ›´æ–°æ¶æ„æ–‡æ¡£
- [ ] æ·»åŠ é›†æˆæµ‹è¯•
- [ ] åˆ›å»ºæ–°é›†æˆçš„ç¤ºä¾‹ï¼ˆTkWebViewï¼‰

## ğŸ¯ æœ€ç»ˆç›®æ ‡

```python
# åº”ç”¨å±‚ä»£ç ä¿æŒç®€å•
webview = QtWebView(parent=maya_window)
webview.emit("scene_updated", data)  # âœ… è‡ªåŠ¨å¤„ç†

# æ·»åŠ æ–°é›†æˆä¹Ÿå¾ˆç®€å•
class MyFrameworkWebView:
    def __init__(self):
        self._webview = WebView()
        processor = MyFrameworkEventProcessor(self._webview)
        self._webview.set_event_processor(processor)
```

**æ ¸å¿ƒåŸåˆ™ï¼š** åº•å±‚è§£å†³é—®é¢˜ï¼Œä¸Šå±‚è‡ªåŠ¨å—ç›Šï¼Œé¿å…é‡å¤ä¿®æ”¹ã€‚

